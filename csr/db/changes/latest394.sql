-- Please update version.sql too -- this keeps clean builds in sync
define version=394
@update_header

begin
	for r in (select table_name from user_tables where table_name in (
		'FACTOR', 'FACTOR_HISTORY', 'GAS_TYPE', 'FACTOR_SET', 'FACTOR_SET_GAS_TYPE', 'FACTOR_TYPE',
		'STD_FACTOR', 'STD_FACTOR_SET', 'STD_MEASURE', 'STD_MEASURE_CONV_SET_ENTRY',
		'STD_MEASURE_CONVERSION', 'STD_MEASURE_CONVERSION_SET')) loop
		execute immediate 'drop table '||r.table_name||' cascade constraints';
	end loop;
	for r in (select sequence_name from user_sequences where sequence_name in (
		'STD_FACTOR_ID_SEQ', 'FACTOR_ID_SEQ', 'GAS_TYPE_ID_SEQ')) loop
		execute immediate 'drop sequence '||r.sequence_name;
	end loop;		
end;
/

CREATE SEQUENCE STD_FACTOR_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    NOORDER
;

-- 
-- SEQUENCE: FACTOR_ID_SEQ 
--

CREATE SEQUENCE FACTOR_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    NOORDER
;


-- 
-- SEQUENCE: GAS_TYPE_ID_SEQ 
--

CREATE SEQUENCE GAS_TYPE_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    NOORDER
;
				

  CREATE TABLE "GAS_TYPE" 
   (	"GAS_TYPE_ID" NUMBER(10,0) NOT NULL, 
	"NAME" VARCHAR2(200 BYTE) NOT NULL, 
	 CONSTRAINT "PK_GAS_TYPE" PRIMARY KEY ("GAS_TYPE_ID")
   ) ;

  

  CREATE TABLE "STD_FACTOR_SET" 
   (	
   "STD_FACTOR_SET_ID" NUMBER(10,0) NOT NULL, 
	"NAME" VARCHAR2(1000 BYTE) NOT NULL, 
	 CONSTRAINT "PK599" PRIMARY KEY ("STD_FACTOR_SET_ID")
   ) ;
 

  CREATE TABLE "STD_MEASURE" 
   (	"STD_MEASURE_ID" NUMBER(10,0) NOT NULL, 
	"NAME" VARCHAR2(255 BYTE) NOT NULL, 
	"DESCRIPTION" VARCHAR2(255 BYTE), 
	"SCALE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"FORMAT_MASK" VARCHAR2(255 BYTE) DEFAULT '#,##0' NOT NULL, 
	"REGIONAL_AGGREGATION" VARCHAR2(255 BYTE) DEFAULT 'sum' NOT NULL, 
	"CUSTOM_FIELD" VARCHAR2(1024 BYTE), 
	"PCT_OWNERSHIP_APPLIES" NUMBER(1,0) DEFAULT 0 NOT NULL, 
	"M" NUMBER(10,0) NOT NULL, 
	"KG" NUMBER(10,0) NOT NULL, 
	"S" NUMBER(10,0) NOT NULL, 
	"A" NUMBER(10,0) NOT NULL, 
	"K" NUMBER(10,0) NOT NULL, 
	"MOL" NUMBER(10,0) NOT NULL, 
	"CD" NUMBER(10,0) NOT NULL, 
	 CONSTRAINT "PK_MEASURE_1" PRIMARY KEY ("STD_MEASURE_ID")
   ) ;



  CREATE TABLE "STD_MEASURE_CONVERSION_SET" 
   (	"STD_MEASURE_CONV_SET_ID" NUMBER(10,0) NOT NULL, 
	"NAME" VARCHAR2(50 BYTE) NOT NULL, 
	"STD_MEASURE_ID" NUMBER(10,0) NOT NULL, 
	 CONSTRAINT "PK609" PRIMARY KEY ("STD_MEASURE_CONV_SET_ID"),
	 CONSTRAINT "REFSTD_MEASURE1227" FOREIGN KEY ("STD_MEASURE_ID")
	  REFERENCES "STD_MEASURE" ("STD_MEASURE_ID")
   ) ;
 

  CREATE TABLE "STD_MEASURE_CONVERSION" 
   (	"STD_MEASURE_CONVERSION_ID" NUMBER(10,0) NOT NULL, 
	"STD_MEASURE_ID" NUMBER(10,0) NOT NULL, 
	"DESCRIPTION" VARCHAR2(255 BYTE), 
	"A" NUMBER(24,10) NOT NULL, 
	"B" NUMBER(24,10) NOT NULL, 
	"C" NUMBER(24,10) NOT NULL, 
	 CONSTRAINT "PK_MEASURE_CONVERSION_1" PRIMARY KEY ("STD_MEASURE_CONVERSION_ID"), 
	 CONSTRAINT "REFSTD_MEASURE1226" FOREIGN KEY ("STD_MEASURE_ID")
	  REFERENCES "STD_MEASURE" ("STD_MEASURE_ID")
   ) ;
 

  CREATE TABLE "STD_MEASURE_CONV_SET_ENTRY" 
   (	"STD_MEASURE_CONV_SET_ID" NUMBER(10,0) NOT NULL, 
	"STD_MEASURE_CONVERSION_ID" NUMBER(10,0) NOT NULL, 
	 CONSTRAINT "PK610" PRIMARY KEY ("STD_MEASURE_CONV_SET_ID", "STD_MEASURE_CONVERSION_ID"),
	 CONSTRAINT "REFSTD_MEASURE_CONVERSION1224" FOREIGN KEY ("STD_MEASURE_CONVERSION_ID")
	  REFERENCES "STD_MEASURE_CONVERSION" ("STD_MEASURE_CONVERSION_ID"), 
	 CONSTRAINT "REFSTD_MEASURE_CONVERSION_1225" FOREIGN KEY ("STD_MEASURE_CONV_SET_ID")
	  REFERENCES "STD_MEASURE_CONVERSION_SET" ("STD_MEASURE_CONV_SET_ID")
   ) ;
 
  CREATE TABLE "FACTOR_TYPE" 
   (	"FACTOR_TYPE_ID" NUMBER(10,0) NOT NULL, 
	"PARENT_ID" NUMBER(10,0), 
	"NAME" VARCHAR2(1000 BYTE) NOT NULL, 
	"STD_MEASURE_CONV_SET_ID" NUMBER(10,0), 
	 CONSTRAINT "PK601" PRIMARY KEY ("FACTOR_TYPE_ID"),
	 CONSTRAINT "REFFACTOR_TYPE1171" FOREIGN KEY ("PARENT_ID")
	  REFERENCES "FACTOR_TYPE" ("FACTOR_TYPE_ID"), 
	 CONSTRAINT "REFSTD_MEASURE_CONVERSION_1238" FOREIGN KEY ("STD_MEASURE_CONV_SET_ID")
	  REFERENCES "STD_MEASURE_CONVERSION_SET" ("STD_MEASURE_CONV_SET_ID")
   );

  CREATE TABLE "STD_FACTOR" 
   (	"STD_FACTOR_ID" NUMBER(10,0) NOT NULL, 
	"STD_FACTOR_SET_ID" NUMBER(10,0) NOT NULL, 
	"FACTOR_TYPE_ID" NUMBER(10,0) NOT NULL, 
	"GAS_TYPE_ID" NUMBER(10,0) NOT NULL, 
	"START_DTM" DATE NOT NULL, 
	"END_DTM" DATE NOT NULL, 
	"GEO_COUNTRY" VARCHAR2(2 BYTE), 
	"GEO_REGION" VARCHAR2(2 BYTE), 
	"VALUE" NUMBER(24,10) NOT NULL, 
	"NOTE" CLOB, 
	"STD_MEASURE_CONVERSION_ID" NUMBER(10,0), 
	 CONSTRAINT "PK_FACTOR_1" PRIMARY KEY ("STD_FACTOR_ID"),
	 CONSTRAINT "REFGAS_TYPE1173" FOREIGN KEY ("GAS_TYPE_ID")
	  REFERENCES "GAS_TYPE" ("GAS_TYPE_ID"), 
	 CONSTRAINT "REFFACTOR_TYPE1174" FOREIGN KEY ("FACTOR_TYPE_ID")
	  REFERENCES "FACTOR_TYPE" ("FACTOR_TYPE_ID"), 
	 CONSTRAINT "REFSTD_FACTOR_SET1176" FOREIGN KEY ("STD_FACTOR_SET_ID")
	  REFERENCES "STD_FACTOR_SET" ("STD_FACTOR_SET_ID"), 
	 CONSTRAINT "REFSTD_MEASURE_CONVERSION1243" FOREIGN KEY ("STD_MEASURE_CONVERSION_ID")
	  REFERENCES "STD_MEASURE_CONVERSION" ("STD_MEASURE_CONVERSION_ID")
   ) ;

  CREATE TABLE "FACTOR" 
   (	"APP_SID" NUMBER(10,0) DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL, 
	"FACTOR_TYPE_ID" NUMBER(10,0), 
	"FACTOR_ID" NUMBER(10,0) NOT NULL, 
	"GAS_TYPE_ID" NUMBER(10,0) NOT NULL, 
	"START_DTM" DATE NOT NULL, 
	"END_DTM" DATE NOT NULL, 
	"GEO_COUNTRY" VARCHAR2(2 BYTE), 
	"GEO_REGION" VARCHAR2(2 BYTE), 
	"REGION_SID" NUMBER(10,0), 
	"VALUE" NUMBER(24,10) NOT NULL, 
	"NOTE" CLOB, 
	"STD_FACTOR_ID" NUMBER(10,0), 
	"STD_MEASURE_CONVERSION_ID" NUMBER(10,0), 
	"IS_SELECTED" NUMBER(1,0), 
	 CONSTRAINT "PK_FACTOR" PRIMARY KEY ("APP_SID", "FACTOR_ID"),
	 CONSTRAINT "REFSTD_FACTOR1237" FOREIGN KEY ("STD_FACTOR_ID")
	  REFERENCES "STD_FACTOR" ("STD_FACTOR_ID"), 
	 CONSTRAINT "REFFACTOR_TYPE1166" FOREIGN KEY ("FACTOR_TYPE_ID")
	  REFERENCES "FACTOR_TYPE" ("FACTOR_TYPE_ID"), 
	 CONSTRAINT "REFREGION1169" FOREIGN KEY ("APP_SID", "REGION_SID")
	  REFERENCES "REGION" ("APP_SID", "REGION_SID"), 
	 CONSTRAINT "REFCUSTOMER1170" FOREIGN KEY ("APP_SID")
	  REFERENCES "CUSTOMER" ("APP_SID"), 
	 CONSTRAINT "FK_FACTOR_GAS_TYPE" FOREIGN KEY ("GAS_TYPE_ID")
	  REFERENCES "GAS_TYPE" ("GAS_TYPE_ID"), 
	 CONSTRAINT "REFSTD_MEASURE_CONVERSION1241" FOREIGN KEY ("STD_MEASURE_CONVERSION_ID")
	  REFERENCES "STD_MEASURE_CONVERSION" ("STD_MEASURE_CONVERSION_ID")
   ) ;

  CREATE TABLE "FACTOR_HISTORY" 
   (	"APP_SID" NUMBER(10,0) NOT NULL, 
	"FACTOR_ID" NUMBER(10,0) NOT NULL, 
	"CHANGED_DTM" NUMBER(10,0) NOT NULL, 
	"USER_SID" NUMBER(10,0) NOT NULL, 
	"OLD_VALUE" NUMBER(24,10) NOT NULL, 
	"NOTE" CLOB NOT NULL, 
	 CONSTRAINT "FK_FACTOR_HISTORY_FACTOR" FOREIGN KEY ("APP_SID", "FACTOR_ID")
	  REFERENCES "FACTOR" ("APP_SID", "FACTOR_ID")
   ) ;
   
   CREATE TABLE "FACTOR_SET" 
   (	"APP_SID" NUMBER(10,0) NOT NULL, 
	"FACTOR_SET_ID" NUMBER(10,0) NOT NULL, 
	"NAME" VARCHAR2(200 BYTE) NOT NULL, 
	"VARIES_BY_GEOGRAPHY" NUMBER(1,0) NOT NULL, 
	"MEASURE_SID" NUMBER(10,0) NOT NULL, 
	 CONSTRAINT "SYS_C00220643" CHECK (varies_by_geography in (0,1)), 
	 CONSTRAINT "PK_FACTOR_SET" PRIMARY KEY ("APP_SID", "FACTOR_SET_ID"),
	 CONSTRAINT "UK_FACTOR_SET_ID" UNIQUE ("FACTOR_SET_ID"),
	 CONSTRAINT "FK_FACTOR_SET_CUSTOMER" FOREIGN KEY ("APP_SID")
	  REFERENCES "CUSTOMER" ("APP_SID"), 
	 CONSTRAINT "FK_FACTOR_SET_MEASURE" FOREIGN KEY ("APP_SID", "MEASURE_SID")
	  REFERENCES "MEASURE" ("APP_SID", "MEASURE_SID")
   ) ;

  CREATE TABLE "FACTOR_SET_GAS_TYPE" 
   (	"APP_SID" NUMBER(10,0) NOT NULL, 
	"FACTOR_SET_ID" NUMBER(10,0) NOT NULL, 
	"GAS_TYPE_ID" NUMBER(10,0) NOT NULL, 
	 CONSTRAINT "UK_FACTOR_SET_GAS_TYPE" UNIQUE ("FACTOR_SET_ID", "GAS_TYPE_ID") ,
	 CONSTRAINT "FK_FACT_SET_GAS_TYPE_FACT_SET" FOREIGN KEY ("APP_SID", "FACTOR_SET_ID")
	  REFERENCES "FACTOR_SET" ("APP_SID", "FACTOR_SET_ID")
   ) ;
 
@update_tail
