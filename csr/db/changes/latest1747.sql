-- Please update version too -- this keeps clean builds in sync
define version=1747
@update_header

CREATE SEQUENCE CHEM.USAGE_AUDIT_LOG_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    nocycle
    CACHE 5
    noorder;

CREATE SEQUENCE CHEM.SUB_AUDIT_LOG_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    nocycle
    CACHE 5
    noorder;

/* ---------------------------------------------------------------------- */
/* Add table "USAGE_AUDIT_LOG"                                            */
/* ---------------------------------------------------------------------- */

CREATE TABLE CHEM.USAGE_AUDIT_LOG (
    APP_SID NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'APP') NOT NULL,
    USAGE_AUDIT_LOG_ID NUMBER(10) NOT NULL,
    SUBSTANCE_ID NUMBER(10) NOT NULL,
    REGION_SID NUMBER(10),
    ROOT_DELEGATION_SID NUMBER(10),
    START_DTM DATE,
    END_DTM DATE,
    DESCRIPTION VARCHAR2(1024) NOT NULL,
    PARAM_1 VARCHAR2(1024),
    PARAM_2 VARCHAR2(1024),
    CHANGED_BY NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'SID') NOT NULL,
    CHANGED_DTM DATE DEFAULT SYSDATE NOT NULL,
    CONSTRAINT PK_USAGE_AUDIT_LOG PRIMARY KEY (APP_SID, USAGE_AUDIT_LOG_ID, SUBSTANCE_ID)
);

/* ---------------------------------------------------------------------- */
/* Add table "SUBSTANCE_AUDIT_LOG"                                        */
/* ---------------------------------------------------------------------- */

CREATE TABLE CHEM.SUBSTANCE_AUDIT_LOG (
    APP_SID NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'APP') NOT NULL,
    SUBSTANCE_AUDIT_LOG_ID NUMBER(10) NOT NULL,
    SUBSTANCE_ID NUMBER(10) NOT NULL,
    DESCRIPTION VARCHAR2(1024) NOT NULL,
    PARAM_1 VARCHAR2(1024),
    PARAM_2 VARCHAR2(1024),
    CHANGED_BY NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'SID') NOT NULL,
    CHANGED_DTM DATE DEFAULT SYSDATE NOT NULL,
    CONSTRAINT PK_SUBSTANCE_AUDIT_LOG PRIMARY KEY (APP_SID, SUBSTANCE_AUDIT_LOG_ID, SUBSTANCE_ID)
);
    
ALTER TABLE CHEM.USAGE_AUDIT_LOG ADD CONSTRAINT FK_SUBST_USAGE_AUDIT
    FOREIGN KEY (APP_SID, SUBSTANCE_ID) REFERENCES CHEM.SUBSTANCE (APP_SID,SUBSTANCE_ID);

ALTER TABLE CHEM.SUBSTANCE_AUDIT_LOG ADD CONSTRAINT FK_SUBST_SUBSTANCE_AUDIT
    FOREIGN KEY (APP_SID, SUBSTANCE_ID) REFERENCES CHEM.SUBSTANCE (APP_SID,SUBSTANCE_ID);


CREATE OR REPLACE PACKAGE CHEM.AUDIT_PKG
AS
PROCEDURE dummy;
END;
/

CREATE OR REPLACE PACKAGE BODY CHEM.AUDIT_PKG
AS
PROCEDURE dummy
AS
BEGIN
	NULL;
END;
END;
/

@..\chem\audit_pkg
@..\chem\audit_body

@..\chem\substance_body

@update_tail