-- Please update version.sql too -- this keeps clean builds in sync
define version=1890
@update_header


CREATE TABLE CSR.ROUTE_LOG(
    LOG_DATE DATE DEFAULT SYSDATE NOT NULL,
    APP_SID       NUMBER(10,0) DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    ROUTE_STEP_ID NUMBER(10,0) NOT NULL,
    ROUTE_ID      NUMBER(10,0) NOT NULL,
    ROUTE_LOG_ID  NUMBER(10,0) NOT NULL,
    CSR_USER_SID  NUMBER(10,0) NOT NULL,
    SUMMARY       VARCHAR2(1023) NOT NULL,
    DESCRIPTION	  CLOB,
    PARAM_1		  VARCHAR2(2048),
    PARAM_2		  VARCHAR2(2048),
    PARAM_3		  VARCHAR2(2048),
    CONSTRAINT PK_ROUTE_LOG PRIMARY KEY (APP_SID, ROUTE_LOG_ID),
    CONSTRAINT FK_ROUTE_LOG_USER FOREIGN KEY (APP_SID, CSR_USER_SID) 
	REFERENCES CSR.CSR_USER (APP_SID, CSR_USER_SID)
);

CREATE SEQUENCE CSR.ROUTE_LOG_ID_SEQ START WITH 1 INCREMENT BY 1 NOMINVALUE NOMAXVALUE CACHE 5 NOORDER;

  
CREATE TABLE CSR.SECTION_ATTACH_LOG(
	APP_SID						NUMBER(10, 0)		DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
	SECTION_ATTACH_LOG_ID		NUMBER(10, 0)		NOT NULL,
	SECTION_SID					NUMBER(10, 0)		NOT NULL,
	ATTACHMENT_ID				NUMBER(10,0)		NOT NULL,
	LOG_DATE					DATE				NOT NULL,
	CSR_USER_SID				NUMBER(10, 0)		NOT NULL,
    SUMMARY       				VARCHAR2(1023) NOT NULL,
    DESCRIPTION 				CLOB,
	PARAM_1		  				VARCHAR2(2048),
    PARAM_2		  				VARCHAR2(2048),
    PARAM_3		  				VARCHAR2(2048),	
	CONSTRAINT PK_SEC_ATTACH_LOG PRIMARY KEY (app_sid, section_attach_log_id),
	CONSTRAINT FK_SEC_ATT_LOG_SEC FOREIGN KEY (app_sid, section_sid)
	REFERENCES csr.section (app_sid, section_sid),
	CONSTRAINT FK_SEC_ATT_LOG_USER FOREIGN KEY (app_sid, csr_user_sid)
	REFERENCES csr.csr_user (app_sid, csr_user_sid)
);

CREATE SEQUENCE CSR.SEC_ATTACH_LOG_ID_SEQ START WITH 1 INCREMENT BY 1 NOMINVALUE NOMAXVALUE CACHE 5 NOORDER;  
 
ALTER TABLE CSR.ROUTE_STEP_VOTE ADD (IS_RETURN NUMBER(1) DEFAULT 0 NOT NULL);
ALTER TABLE CSR.ROUTE_STEP_VOTE ADD CONSTRAINT CHK_RETURN
  CHECK (IS_RETURN IN (0,1));
  
@../section_root_pkg
@../section_pkg  
@../section_root_body
@../section_body
 
@update_tail