-- Please update version.sql too -- this keeps clean builds in sync
define version=436
@update_header

CREATE SEQUENCE CALCULATION_TYPE_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 20
    NOORDER
;

CREATE TABLE CALCULATION_TYPE(
    CALCULATION_TYPE_ID    NUMBER(10, 0)     NOT NULL,
    DESCRIPTION            VARCHAR2(1023)    NOT NULL,
    CONSTRAINT PK755 PRIMARY KEY (CALCULATION_TYPE_ID)
)
;

CREATE TABLE DATAVIEW_IND_MEMBER(
    APP_SID                NUMBER(10, 0)     DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    DATAVIEW_SID           NUMBER(10, 0)     NOT NULL,
    IND_SID                NUMBER(10, 0)     NOT NULL,
    DESCRIPTION            VARCHAR2(1023),
    CALCULATION_TYPE_ID    NUMBER(10, 0),
    CONSTRAINT PK753 PRIMARY KEY (APP_SID, DATAVIEW_SID)
)
;

CREATE TABLE DATAVIEW_REGION_MEMBER(
    APP_SID         NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    DATAVIEW_SID    NUMBER(10, 0)    NOT NULL,
    REGION_SID      NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK754 PRIMARY KEY (APP_SID, DATAVIEW_SID)
)
;

ALTER TABLE DATAVIEW_IND_MEMBER ADD CONSTRAINT RefIND1604 
    FOREIGN KEY (APP_SID, IND_SID)
    REFERENCES CSR.IND(APP_SID, IND_SID)
;

ALTER TABLE DATAVIEW_IND_MEMBER ADD CONSTRAINT RefCALCULATION_TYPE1605 
    FOREIGN KEY (CALCULATION_TYPE_ID)
    REFERENCES CALCULATION_TYPE(CALCULATION_TYPE_ID)
;

ALTER TABLE DATAVIEW_IND_MEMBER ADD CONSTRAINT RefDATAVIEW1606 
    FOREIGN KEY (APP_SID, DATAVIEW_SID)
    REFERENCES CSR.DATAVIEW(APP_SID, DATAVIEW_SID)
;

ALTER TABLE DATAVIEW_REGION_MEMBER ADD CONSTRAINT RefREGION1607 
    FOREIGN KEY (APP_SID, REGION_SID)
    REFERENCES REGION(APP_SID, REGION_SID)
;

ALTER TABLE DATAVIEW_REGION_MEMBER ADD CONSTRAINT RefDATAVIEW1608 
    FOREIGN KEY (APP_SID, DATAVIEW_SID)
    REFERENCES CSR.DATAVIEW(APP_SID, DATAVIEW_SID)
;

@update_tail
