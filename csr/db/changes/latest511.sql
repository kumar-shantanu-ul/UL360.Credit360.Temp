-- Please update version.sql too -- this keeps clean builds in sync
define version=511
@update_header

CONNECT actions/actions@&_CONNECT_IDENTIFIER

GRANT REFERENCES ON ACTIONS.TAG_GROUP TO CSR;

GRANT REFERENCES ON ACTIONS.TAG TO CSR;

CONNECT CSR/CSR@&_CONNECT_IDENTIFIER

-- TABLE: CSR.AXIS 
--

CREATE TABLE CSR.AXIS(
    AXIS_ID                        NUMBER(10, 0)    NOT NULL,
    APP_SID                        NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    NAME                           VARCHAR2(255)    NOT NULL,
    LABEL                          VARCHAR2(255)    NOT NULL,
    CMS_TABLE                      VARCHAR2(30)     NOT NULL,
    AXIS_MEMBER_PAGE_TEMPLATE      NUMBER(10, 0)    NOT NULL,
    PRIMARY_ACTION_TAG_GROUP_ID    NUMBER(10, 0)    NOT NULL,
    RELATED_ACTION_TAG_GROUP_ID    NUMBER(10, 0)    NOT NULL,
    PRIMARY_IND_TAG_GROUP_ID       NUMBER(10, 0)    NOT NULL,
    RELATED_IND_TAG_GROUP_ID       NUMBER(10, 0)    NOT NULL,
    PRIMARY_TAG_GROUP_ID           NUMBER(10, 0)    NOT NULL,
    RELATED_TAG_GROUP_ID           NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK_AXIS PRIMARY KEY (AXIS_ID, APP_SID)
)
;



-- 
-- TABLE: CSR.AXIS_MEMBER 
--

CREATE TABLE CSR.AXIS_MEMBER(
    APP_SID           NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    AXIS_MEMBER_ID    NUMBER(10, 0)    NOT NULL,
    AXIS_ID           NUMBER(10, 0)    NOT NULL,
    NAME              VARCHAR2(255)    NOT NULL,
    LABEL             VARCHAR2(255)    NOT NULL,
    ACTION_TAG_ID     NUMBER(10, 0)    NOT NULL,
    TAG_ID            NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK_AXIS_MEMBER PRIMARY KEY (APP_SID, AXIS_MEMBER_ID)
)
;

-- 
-- TABLE: CSR.IND_PAGE_PRIMARY_AXIS_MEMBER 
--

CREATE TABLE CSR.IND_PAGE_PRIMARY_AXIS_MEMBER(
    APP_SID           NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    AXIS_MEMBER_ID    NUMBER(10, 0)    NOT NULL,
    IND_PAGE_ID       NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK_IND_PG_PRI_AXIS_M PRIMARY KEY (AXIS_MEMBER_ID, IND_PAGE_ID, APP_SID)
)
;

-- 
-- TABLE: CSR.IND_PAGE_RELATED_AXIS_MEMBER 
--

CREATE TABLE CSR.IND_PAGE_RELATED_AXIS_MEMBER(
    APP_SID           NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    AXIS_MEMBER_ID    NUMBER(10, 0)    NOT NULL,
    IND_PAGE_ID       NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK_IND_PG_REL_AXIS_M PRIMARY KEY (AXIS_MEMBER_ID, IND_PAGE_ID, APP_SID)
)
;

-- 
-- TABLE: CSR.RELATED_AXIS_MEMBER 
--

CREATE TABLE CSR.RELATED_AXIS_MEMBER(
    APP_SID                   NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    AXIS_MEMBER_ID            NUMBER(10, 0)    NOT NULL,
    RELATED_AXIS_MEMBER_ID    NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK160 PRIMARY KEY (AXIS_MEMBER_ID, RELATED_AXIS_MEMBER_ID, APP_SID)
)
;

-- 
-- TABLE: CSR.AXIS 
--


ALTER TABLE CSR.AXIS ADD CONSTRAINT FK_CUSTOMER_AXIS 
    FOREIGN KEY (APP_SID)
    REFERENCES CUSTOMER(APP_SID)
;

ALTER TABLE CSR.AXIS ADD CONSTRAINT FK_PRI_ACTION_TAG_GRP 
    FOREIGN KEY (PRIMARY_ACTION_TAG_GROUP_ID, APP_SID)
    REFERENCES ACTIONS.TAG_GROUP(TAG_GROUP_ID, APP_SID)
;

ALTER TABLE CSR.AXIS ADD CONSTRAINT FK_REL_ACTION_TAG_GRP 
    FOREIGN KEY (RELATED_ACTION_TAG_GROUP_ID, APP_SID)
    REFERENCES ACTIONS.TAG_GROUP(TAG_GROUP_ID, APP_SID)
;

ALTER TABLE CSR.AXIS ADD CONSTRAINT FK_PRI_TAG_GROUP_AXIS 
    FOREIGN KEY (APP_SID, PRIMARY_TAG_GROUP_ID)
    REFERENCES TAG_GROUP(APP_SID, TAG_GROUP_ID)
;

ALTER TABLE CSR.AXIS ADD CONSTRAINT FK_REL_TAG_GROUP_AXIS 
    FOREIGN KEY (APP_SID, RELATED_TAG_GROUP_ID)
    REFERENCES TAG_GROUP(APP_SID, TAG_GROUP_ID)
;


-- 
-- TABLE: CSR.AXIS_MEMBER 
--

ALTER TABLE CSR.AXIS_MEMBER ADD CONSTRAINT FK_AXIS_MEM_ACTION_TAG 
    FOREIGN KEY (ACTION_TAG_ID, APP_SID)
    REFERENCES ACTIONS.TAG(TAG_ID, APP_SID)
;

ALTER TABLE CSR.AXIS_MEMBER ADD CONSTRAINT FK_AXIS_MEMBER 
    FOREIGN KEY (AXIS_ID, APP_SID)
    REFERENCES CSR.AXIS(AXIS_ID, APP_SID)
;

ALTER TABLE CSR.AXIS_MEMBER ADD CONSTRAINT FK_CUSTOMER_AXIS_MEMBER 
    FOREIGN KEY (APP_SID)
    REFERENCES CUSTOMER(APP_SID)
;

ALTER TABLE CSR.AXIS_MEMBER ADD CONSTRAINT FK_TAG_AXIS_MEMBER 
    FOREIGN KEY (APP_SID, TAG_ID)
    REFERENCES TAG(APP_SID, TAG_ID)
;

-- 
-- TABLE: CSR.IND_PAGE_PRIMARY_AXIS_MEMBER 
--

ALTER TABLE CSR.IND_PAGE_PRIMARY_AXIS_MEMBER ADD CONSTRAINT FK_AMEMBER_PRI_IND 
    FOREIGN KEY (APP_SID, AXIS_MEMBER_ID)
    REFERENCES CSR.AXIS_MEMBER(APP_SID, AXIS_MEMBER_ID)
;


-- 
-- TABLE: CSR.IND_PAGE_RELATED_AXIS_MEMBER 
--

ALTER TABLE CSR.IND_PAGE_RELATED_AXIS_MEMBER ADD CONSTRAINT FK_AMEMBER_REL_IND 
    FOREIGN KEY (APP_SID, AXIS_MEMBER_ID)
    REFERENCES CSR.AXIS_MEMBER(APP_SID, AXIS_MEMBER_ID)
;

-- 
-- TABLE: CSR.RELATED_AXIS_MEMBER 
--

ALTER TABLE CSR.RELATED_AXIS_MEMBER ADD CONSTRAINT FK_REL_AXIS_MEMBER 
    FOREIGN KEY (APP_SID, AXIS_MEMBER_ID)
    REFERENCES CSR.AXIS_MEMBER(APP_SID, AXIS_MEMBER_ID)
;

ALTER TABLE CSR.RELATED_AXIS_MEMBER ADD CONSTRAINT FK_REL_REL_AXIS_MEMBER 
    FOREIGN KEY (APP_SID, RELATED_AXIS_MEMBER_ID)
    REFERENCES CSR.AXIS_MEMBER(APP_SID, AXIS_MEMBER_ID)
;


@update_tail


