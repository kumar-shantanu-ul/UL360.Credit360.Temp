-- Please update version.sql too -- this keeps clean builds in sync
define version=866
@update_header

CREATE TABLE CSR.IMP_VOCAB(
    APP_SID            NUMBER(10, 0)     DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    CSR_USER_SID       NUMBER(10, 0)     NOT NULL,
    IMP_TAG_TYPE_ID    NUMBER(10, 0)     NOT NULL,
    PHRASE             VARCHAR2(4000)    NOT NULL,
    FREQUENCY          NUMBER(10, 0)     DEFAULT 0 NOT NULL,
    CONSTRAINT PK_IMP_VOCAB PRIMARY KEY (APP_SID, CSR_USER_SID, IMP_TAG_TYPE_ID, PHRASE)
)
;

CREATE TABLE CSR.IMP_TAG_TYPE(
    IMP_TAG_TYPE_ID    NUMBER(10, 0)    NOT NULL,
    DESCRIPTION        VARCHAR2(255)    NOT NULL,
    MEANS_IGNORE       NUMBER(1, 0)     DEFAULT 0 NOT NULL,
    CHECK (MEANS_IGNORE IN(1,0)),
    CONSTRAINT PK_IMP_TAG_TYPE PRIMARY KEY (IMP_TAG_TYPE_ID)
)
;

ALTER TABLE CSR.IMP_VOCAB ADD CONSTRAINT FK_IMP_VOCAB_CSR_USER 
    FOREIGN KEY (APP_SID, CSR_USER_SID)
    REFERENCES CSR.CSR_USER(APP_SID, CSR_USER_SID)
;

ALTER TABLE CSR.IMP_VOCAB ADD CONSTRAINT FK_IMP_VOCAB_IMP_TAG_TYPE 
    FOREIGN KEY (IMP_TAG_TYPE_ID)
    REFERENCES CSR.IMP_TAG_TYPE(IMP_TAG_TYPE_ID)
;

INSERT INTO CSR.IMP_TAG_TYPE (IMP_TAG_TYPE_ID, DESCRIPTION, MEANS_IGNORE) VALUES (0, 'Irrelevant', 1);
INSERT INTO CSR.IMP_TAG_TYPE (IMP_TAG_TYPE_ID, DESCRIPTION, MEANS_IGNORE) VALUES (1, 'Always ignore', 1);
INSERT INTO CSR.IMP_TAG_TYPE (IMP_TAG_TYPE_ID, DESCRIPTION, MEANS_IGNORE) VALUES (2, 'Unit', 0);
INSERT INTO CSR.IMP_TAG_TYPE (IMP_TAG_TYPE_ID, DESCRIPTION, MEANS_IGNORE) VALUES (3, 'Date', 0);
INSERT INTO CSR.IMP_TAG_TYPE (IMP_TAG_TYPE_ID, DESCRIPTION, MEANS_IGNORE) VALUES (4, 'Region', 0);
INSERT INTO CSR.IMP_TAG_TYPE (IMP_TAG_TYPE_ID, DESCRIPTION, MEANS_IGNORE) VALUES (5, 'Indicator', 0);


@../imp_pkg
@../imp_body

@update_tail
