-- Please update version.sql too -- this keeps clean builds in sync
define version=929
@update_header

ALTER TABLE CSR.ALL_METER ADD ( 
    COSTDAYS_IND_SID                  NUMBER(10, 0),
    COSTDAYS_MEASURE_CONVERSION_ID    NUMBER(10, 0)
);
 
ALTER TABLE CSR.ALL_METER ADD CONSTRAINT FK_IND_METER_CDY 
    FOREIGN KEY (APP_SID, COSTDAYS_IND_SID)
    REFERENCES CSR.IND(APP_SID, IND_SID);
 
ALTER TABLE CSR.ALL_METER ADD CONSTRAINT FK_MEAS_CONV_METER_CDY 
    FOREIGN KEY (APP_SID, COSTDAYS_MEASURE_CONVERSION_ID)
    REFERENCES CSR.MEASURE_CONVERSION(APP_SID, MEASURE_CONVERSION_ID);

CREATE OR REPLACE VIEW csr.METER
	(APP_SID,REGION_SID, NOTE, PRIMARY_IND_SID, PRIMARY_MEASURE_CONVERSION_ID, METER_SOURCE_TYPE_ID, REFERENCE, CRC_METER, COST_IND_SID, COST_MEASURE_CONVERSION_ID, DAYS_IND_SID, DAYS_MEASURE_CONVERSION_ID, COSTDAYS_IND_SID, COSTDAYS_MEASURE_CONVERSION_ID) AS
  SELECT APP_SID,REGION_SID, NOTE, PRIMARY_IND_SID, PRIMARY_MEASURE_CONVERSION_ID, METER_SOURCE_TYPE_ID, REFERENCE, CRC_METER,
	COST_IND_SID, COST_MEASURE_CONVERSION_ID, DAYS_IND_SID, DAYS_MEASURE_CONVERSION_ID, COSTDAYS_IND_SID, COSTDAYS_MEASURE_CONVERSION_ID
    FROM ALL_METER
   WHERE ACTIVE = 1;


@..\meter_pkg
@..\meter_body

@update_tail
