-- Please update version.sql too -- this keeps clean builds in sync
define version=2662
@update_header

CREATE TABLE CSRIMP.DELEGATION_POLICY (
	CSRIMP_SESSION_ID		    NUMBER(10) 			DEFAULT SYS_CONTEXT('SECURITY', 'CSRIMP_SESSION_ID') NOT NULL,
	DELEGATION_SID      	    NUMBER(10)          NOT NULL,
	SUBMIT_CONFIRMATION_TEXT	VARCHAR2(500)       NOT NULL,
	CONSTRAINT PK_DELEGATION_POLICY PRIMARY KEY (CSRIMP_SESSION_ID, DELEGATION_SID),
	CONSTRAINT FK_DELEGATION_POLICY_IS FOREIGN KEY
    	(CSRIMP_SESSION_ID) REFERENCES CSRIMP.CSRIMP_SESSION (CSRIMP_SESSION_ID)
    	ON DELETE CASCADE
);

ALTER TABLE CSRIMP.DELEGATION_IND ADD (ALLOWED_NA NUMBER(1, 0) DEFAULT 0 NOT NULL);

GRANT SELECT, INSERT, UPDATE ON csr.delegation_policy TO csrimp;
GRANT SELECT, INSERT, UPDATE, DELETE ON csrimp.delegation_policy TO web_user;

@../csrimp/imp_body
@../schema_pkg
@../schema_body

@update_tail
