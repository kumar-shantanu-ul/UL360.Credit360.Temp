-- Please update version.sql too -- this keeps clean builds in sync
define version=2752
define minor_version=19
@update_header

CREATE SEQUENCE CSR.COURSE_FILE_ID_SEQ
	START WITH 1
	INCREMENT BY 1
	NOMINVALUE
	NOMAXVALUE
	CACHE 20
	NOORDER
;

CREATE TABLE CSR.COURSE_FILE(
	APP_SID					NUMBER(10,0) DEFAULT SYS_CONTEXT('SECURITY','APP'), 
	COURSE_ID				NUMBER(10,0), 
	COURSE_FILE_DATA_ID		NUMBER(10,0)
);

CREATE TABLE CSR.COURSE_FILE_DATA(
	APP_SID 				NUMBER(10,0) DEFAULT SYS_CONTEXT('SECURITY','APP'), 
	COURSE_FILE_DATA_ID		NUMBER(10,0), 
	FILENAME				VARCHAR2(255 BYTE), 
	MIME_TYPE				VARCHAR2(255 BYTE), 
	DATA					BLOB, 
	SHA1 					RAW(20), 
	UPLOADED_DTM			DATE DEFAULT SYSDATE
);

ALTER TABLE CSR.COURSE_FILE ADD CONSTRAINT PK_COURSE_FILE_CONN PRIMARY KEY (APP_SID, COURSE_ID, COURSE_FILE_DATA_ID);
ALTER TABLE CSR.COURSE_FILE_DATA ADD CONSTRAINT PK_COURSE_FILE PRIMARY KEY (APP_SID, COURSE_FILE_DATA_ID);
ALTER TABLE CSR.COURSE_FILE ADD CONSTRAINT FK_COURSE_FILE_CONN_COURSE FOREIGN KEY (APP_SID, COURSE_ID)
	REFERENCES CSR.COURSE (APP_SID, COURSE_ID);
ALTER TABLE CSR.COURSE_FILE ADD CONSTRAINT FK_COURSE_FILE_CONN_FILE FOREIGN KEY (APP_SID, COURSE_FILE_DATA_ID)
	REFERENCES CSR.COURSE_FILE_DATA (APP_SID, COURSE_FILE_DATA_ID) ON DELETE CASCADE;

@../training_pkg
@../training_body

@update_tail
