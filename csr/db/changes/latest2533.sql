-- Please update version.sql too -- this keeps clean builds in sync
define version=2533
@update_header


ALTER TABLE CSR.EST_METER DROP CONSTRAINT FK_EST_BUILDING_METER;

ALTER TABLE CSR.EST_METER ADD CONSTRAINT FK_EST_BUILDING_METER 
    FOREIGN KEY (APP_SID, EST_ACCOUNT_SID, PM_CUSTOMER_ID, PM_BUILDING_ID)
    REFERENCES CSR.EST_BUILDING(APP_SID, EST_ACCOUNT_SID, PM_CUSTOMER_ID, PM_BUILDING_ID)  DEFERRABLE INITIALLY DEFERRED
;


ALTER TABLE CSR.EST_METER DROP CONSTRAINT FK_EST_SPACE_METER;

ALTER TABLE CSR.EST_METER ADD CONSTRAINT FK_EST_SPACE_METER 
    FOREIGN KEY (APP_SID, EST_ACCOUNT_SID, PM_CUSTOMER_ID, PM_BUILDING_ID, PM_SPACE_ID)
    REFERENCES CSR.EST_SPACE(APP_SID, EST_ACCOUNT_SID, PM_CUSTOMER_ID, PM_BUILDING_ID, PM_SPACE_ID)
;

@update_tail
