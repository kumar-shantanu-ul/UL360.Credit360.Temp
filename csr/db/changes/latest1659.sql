-- Please update version.sql too -- this keeps clean builds in sync
define version=1659
@update_header

DROP INDEX CSR.UK_EST_BUILDING_ESP_ID;
DROP INDEX CSR.UK_EST_ENERGY_METER_ESP_ID;
DROP INDEX CSR.UK_EST_SPACE_ESP_ID;
DROP INDEX CSR.UK_EST_WATER_METER_ESP_ID;

CREATE UNIQUE INDEX CSR.UK_EST_BUILDING_ESP_ID ON CSR.EST_BUILDING(NVL2(ESP_ID, APP_SID, NULL), ESP_ID);
CREATE UNIQUE INDEX CSR.UK_EST_ENERGY_METER_ESP_ID ON CSR.EST_ENERGY_METER(NVL2(ESP_ID, APP_SID, NULL), ESP_ID);
CREATE UNIQUE INDEX CSR.UK_EST_SPACE_ESP_ID ON CSR.EST_SPACE(NVL2(ESP_ID, APP_SID, NULL), ESP_ID);
CREATE UNIQUE INDEX CSR.UK_EST_WATER_METER_ESP_ID ON CSR.EST_WATER_METER(NVL2(ESP_ID, APP_SID, NULL), ESP_ID);

@update_tail


