-- Please update version.sql too -- this keeps clean builds in sync
define version=3018
define minor_version=11
@update_header

-- *** DDL ***
-- Create tables

CREATE SEQUENCE CSR.CUSTOM_FACTOR_HISTORY_SEQ;

CREATE TABLE CSR.CUSTOM_FACTOR_HISTORY (
	APP_SID					NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'APP') NOT NULL,
	CUSTOM_FACTOR_HISTORY_ID	NUMBER(10) NOT NULL,
	FACTOR_CAT_ID			NUMBER(10) NOT NULL,
	FACTOR_TYPE_ID			NUMBER(10) NOT NULL,
	FACTOR_SET_ID			NUMBER(10) NOT NULL,
	GEO_COUNTRY				VARCHAR2(2),
	GEO_REGION				VARCHAR2(2),
	EGRID_REF				VARCHAR2(4),
	REGION_SID				NUMBER(10),
	GAS_TYPE_ID				NUMBER(10),
	START_DTM				DATE NOT NULL,
	END_DTM					DATE,
	FIELD_NAME				VARCHAR2(1024),
	OLD_VAL					VARCHAR2(1024),
	NEW_VAL					VARCHAR2(1024),
	MESSAGE					VARCHAR2(1024),
	AUDIT_DATE				DATE DEFAULT SYSDATE NOT NULL,
	USER_SID				NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY','SID') NOT NULL,
	CONSTRAINT PK_CUSTOM_FACTOR_HISTORY PRIMARY KEY (APP_SID, CUSTOM_FACTOR_HISTORY_ID)
);

CREATE TABLE CSRIMP.CUSTOM_FACTOR_HISTORY (
	CSRIMP_SESSION_ID	NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'CSRIMP_SESSION_ID') NOT NULL,
	CUSTOM_FACTOR_HISTORY_ID	NUMBER(10) NOT NULL,
	FACTOR_CAT_ID			NUMBER(10) NOT NULL,
	FACTOR_TYPE_ID			NUMBER(10) NOT NULL,
	FACTOR_SET_ID			NUMBER(10) NOT NULL,
	GEO_COUNTRY				VARCHAR2(2),
	GEO_REGION				VARCHAR2(2),
	EGRID_REF				VARCHAR2(4),
	REGION_SID				NUMBER(10),
	GAS_TYPE_ID				NUMBER(10),
	START_DTM				DATE NOT NULL,
	END_DTM					DATE,
	FIELD_NAME				VARCHAR2(1024),
	OLD_VAL					VARCHAR2(1024),
	NEW_VAL					VARCHAR2(1024),
	MESSAGE					VARCHAR2(1024),
	AUDIT_DATE				DATE NOT NULL,
	USER_SID				NUMBER(10) NOT NULL,
	CONSTRAINT PK_CUSTOM_FACTOR_HISTORY PRIMARY KEY (CSRIMP_SESSION_ID, CUSTOM_FACTOR_HISTORY_ID),
	CONSTRAINT FK_CUSTOM_FACTOR_HISTORY_IS FOREIGN KEY (CSRIMP_SESSION_ID) REFERENCES CSRIMP.CSRIMP_SESSION (CSRIMP_SESSION_ID) ON DELETE CASCADE
);

-- Alter tables

-- *** Grants ***

GRANT SELECT, INSERT, UPDATE ON csr.CUSTOM_FACTOR_HISTORY to CSRIMP;
GRANT SELECT, INSERT, UPDATE, DELETE ON CSRIMP.CUSTOM_FACTOR_HISTORY TO TOOL_USER;
GRANT SELECT ON csr.custom_factor_history_seq TO CSRIMP;

-- ** Cross schema constraints ***

-- *** Views ***
-- Please paste the content of the view and add a comment referencing the path of the create_views file which will contain your view changes.

-- *** Data changes ***
-- RLS

-- Data

-- ** New package grants **

-- *** Conditional Packages ***

-- *** Packages ***

@../csr_data_pkg
@../factor_pkg
@../schema_pkg

@../factor_body
@../schema_body
@../csrimp/imp_body


@update_tail
