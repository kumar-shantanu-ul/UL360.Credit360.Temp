-- Please update version.sql too -- this keeps clean builds in sync
define version=2997
define minor_version=9
@update_header

-- *** DDL ***
-- Create tables
CREATE TABLE CSR.IA_TYPE_REPORT_GROUP (
	APP_SID 						NUMBER(10) DEFAULT SYS_CONTEXT('APP', 'SECURITY') NOT NULL,
	IA_TYPE_REPORT_GROUP_ID 		NUMBER(10) NOT NULL,
	LABEL 							VARCHAR(255) NOT NULL,
	CONSTRAINT PK_IA_TYPE_REPORT_GROUP PRIMARY KEY (APP_SID, IA_TYPE_REPORT_GROUP_ID)
);

CREATE SEQUENCE CSR.IA_TYPE_REPORT_GROUP_ID_SEQ CACHE 5;

CREATE TABLE CSRIMP.IA_TYPE_REPORT_GROUP (
	CSRIMP_SESSION_ID				NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'CSRIMP_SESSION_ID') NOT NULL,
	IA_TYPE_REPORT_GROUP_ID			NUMBER(10) NOT NULL,
	LABEL							VARCHAR(255) NOT NULL,
	CONSTRAINT PK_IA_TYPE_REPORT_GROUP PRIMARY KEY (CSRIMP_SESSION_ID, IA_TYPE_REPORT_GROUP_ID),
	CONSTRAINT FK_IA_TYPE_REPORT_GROUP_IS FOREIGN KEY (CSRIMP_SESSION_ID) REFERENCES CSRIMP.CSRIMP_SESSION (CSRIMP_SESSION_ID) ON DELETE CASCADE
);

CREATE TABLE CSRIMP.MAP_IA_TYPE_REPORT_GROUP (
	CSRIMP_SESSION_ID					NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'CSRIMP_SESSION_ID') NOT NULL,
	OLD_IA_TYPE_REPORT_GROUP_ID			NUMBER(10)	NOT NULL,
	NEW_IA_TYPE_REPORT_GROUP_ID			NUMBER(10)	NOT NULL,
	CONSTRAINT PK_MAP_IA_TYPE_REPORT_GROUP PRIMARY KEY (CSRIMP_SESSION_ID, OLD_IA_TYPE_REPORT_GROUP_ID) USING INDEX,
	CONSTRAINT UK_MAP_IA_TYPE_REPORT_GROUP UNIQUE (CSRIMP_SESSION_ID, NEW_IA_TYPE_REPORT_GROUP_ID) USING INDEX,
	CONSTRAINT FK_MAP_IA_TYPE_REPORT_GROUP FOREIGN KEY
		(CSRIMP_SESSION_ID) REFERENCES CSRIMP.CSRIMP_SESSION (CSRIMP_SESSION_ID)
		ON DELETE CASCADE
);

-- Alter tables
ALTER TABLE CSR.INTERNAL_AUDIT_TYPE_REPORT ADD IA_TYPE_REPORT_GROUP_ID NUMBER(10) NULL;
ALTER TABLE CSR.INTERNAL_AUDIT_TYPE_REPORT ADD CONSTRAINT FK_IA_REPORT_GROUP FOREIGN KEY (APP_SID, IA_TYPE_REPORT_GROUP_ID)
	REFERENCES CSR.IA_TYPE_REPORT_GROUP;

ALTER TABLE CSRIMP.INTERNAL_AUDIT_TYPE_REPORT ADD IA_TYPE_REPORT_GROUP_ID NUMBER(10) NULL;

-- *** Grants ***
GRANT INSERT ON CSR.IA_TYPE_REPORT_GROUP TO CSRIMP;
GRANT SELECT ON CSR.IA_TYPE_REPORT_GROUP_ID_SEQ TO CSRIMP;
GRANT SELECT,INSERT,UPDATE,DELETE ON CSRIMP.INTERNAL_AUDIT_TYPE_REPORT TO TOOL_USER;
GRANT SELECT,INSERT,UPDATE,DELETE ON CSRIMP.IA_TYPE_REPORT_GROUP TO TOOL_USER;

-- ** Cross schema constraints ***

-- *** Views ***
-- Please paste the content of the view and add a comment referencing the path of the create_views file which will contain your view changes.

-- *** Data changes ***
-- RLS

-- Data

-- ** New package grants **

-- *** Conditional Packages ***

-- *** Packages ***
@../audit_pkg
@../schema_pkg

@../audit_body
@../schema_body

@../csrimp/imp_body

@update_tail
