-- Please update version.sql too -- this keeps clean builds in sync
define version=22
@update_header


alter table region add (    LINK_TO_REGION_SID    NUMBER(10, 0));

ALTER TABLE REGION ADD CONSTRAINT RefREGION219 
    FOREIGN KEY (LINK_TO_REGION_SID)
    REFERENCES REGION(REGION_SID)
;
 


CREATE SEQUENCE TAG_ID_SEQ 
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 5
    NOORDER
;

CREATE SEQUENCE TAG_GROUP_ID_SEQ 
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 5
    NOORDER
;

CREATE TABLE IND_TAG(
    TAG_ID     NUMBER(10, 0)    NOT NULL,
    IND_SID    NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK138 PRIMARY KEY (TAG_ID, IND_SID)
)
;



CREATE TABLE REGION_TAG(
    TAG_ID        NUMBER(10, 0)    NOT NULL,
    REGION_SID    NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK137 PRIMARY KEY (TAG_ID, REGION_SID)
)
;




-- 
-- TABLE: TAG 
--

CREATE TABLE TAG(
    TAG_ID         NUMBER(10, 0)     NOT NULL,
    TAG            VARCHAR2(255)     NOT NULL,
    EXPLANATION    VARCHAR2(1024),
    CONSTRAINT PK6_1 PRIMARY KEY (TAG_ID)
)
;



-- 
-- TABLE: TAG_GROUP 
--

CREATE TABLE TAG_GROUP(
    TAG_GROUP_ID          NUMBER(10, 0)    NOT NULL,
    CSR_ROOT_SID          NUMBER(10, 0)    NOT NULL,
    NAME                  VARCHAR2(255)    NOT NULL,
    MULTI_SELECT          NUMBER(10, 0)     DEFAULT 0 NOT NULL,
    MANDATORY             NUMBER(10, 0)     DEFAULT 1 NOT NULL,
    APPLIES_TO_INDS       NUMBER(1, 0)      DEFAULT 0 NOT NULL,
    APPLIES_TO_REGIONS    NUMBER(1, 0)      DEFAULT 0 NOT NULL,
    CONSTRAINT PK9_1 PRIMARY KEY (TAG_GROUP_ID)
)
;



-- 
-- TABLE: TAG_GROUP_MEMBER 
--

CREATE TABLE TAG_GROUP_MEMBER(
    TAG_GROUP_ID    NUMBER(10, 0)    NOT NULL,
    TAG_ID          NUMBER(10, 0)    NOT NULL,
    POS             NUMBER(10, 0)     DEFAULT 0 NOT NULL,
    CONSTRAINT PK10 PRIMARY KEY (TAG_GROUP_ID, TAG_ID)
)
;


-- 
-- TABLE: IND_TAG 
--

ALTER TABLE IND_TAG ADD CONSTRAINT RefIND227 
    FOREIGN KEY (IND_SID)
    REFERENCES IND(IND_SID)
;

ALTER TABLE IND_TAG ADD CONSTRAINT RefTAG228 
    FOREIGN KEY (TAG_ID)
    REFERENCES TAG(TAG_ID)
;

-- 
-- TABLE: REGION_TAG 
--

ALTER TABLE REGION_TAG ADD CONSTRAINT RefREGION229 
    FOREIGN KEY (REGION_SID)
    REFERENCES REGION(REGION_SID)
;

ALTER TABLE REGION_TAG ADD CONSTRAINT RefTAG230 
    FOREIGN KEY (TAG_ID)
    REFERENCES TAG(TAG_ID)
;

-- 
-- TABLE: TAG_GROUP 
--

ALTER TABLE TAG_GROUP ADD CONSTRAINT RefCUSTOMER231 
    FOREIGN KEY (CSR_ROOT_SID)
    REFERENCES CUSTOMER(CSR_ROOT_SID)
;


-- 
-- TABLE: TAG_GROUP_MEMBER 
--

ALTER TABLE TAG_GROUP_MEMBER ADD CONSTRAINT RefTAG_GROUP232 
    FOREIGN KEY (TAG_GROUP_ID)
    REFERENCES TAG_GROUP(TAG_GROUP_ID)
;

ALTER TABLE TAG_GROUP_MEMBER ADD CONSTRAINT RefTAG233 
    FOREIGN KEY (TAG_ID)
    REFERENCES TAG(TAG_ID)
;


ALTER TABLE RANGE_IND_MEMBER ADD MULTIPLIER_IND_SID NUMBER(10, 0);


ALTER TABLE RANGE_IND_MEMBER ADD CONSTRAINT RefIND235 
    FOREIGN KEY (MULTIPLIER_IND_SID)
    REFERENCES IND(IND_SID);



@update_tail
