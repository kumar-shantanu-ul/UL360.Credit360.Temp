-- Please update version.sql too -- this keeps clean builds in sync
define version=445
@update_header

BEGIN	
	FOR r IN (
		SELECT constraint_name
	  	  FROM user_constraints
		 WHERE table_name = 'PROPERTY_DIVISION'
		   and constraint_type = 'R'
	) 
	LOOP
		EXECUTE IMMEDIATE 'ALTER TABLE csr.property_division DROP CONSTRAINT ' || r.constraint_name;
	END LOOP;
END;
/

ALTER TABLE division
DROP PRIMARY KEY CASCADE DROP INDEX;

ALTER TABLE division
	ADD CONSTRAINT PK760 PRIMARY KEY (APP_SID, DIVISION_ID);
	
ALTER TABLE property
DROP PRIMARY KEY CASCADE DROP INDEX;

ALTER TABLE property
	ADD CONSTRAINT PK761 PRIMARY KEY (APP_SID, PROPERTY_ID);

ALTER TABLE PROPERTY_DIVISION ADD CONSTRAINT RefPROPERTY1617 
    FOREIGN KEY (APP_SID, PROPERTY_ID)
    REFERENCES PROPERTY(APP_SID, PROPERTY_ID)
;

ALTER TABLE PROPERTY_DIVISION ADD CONSTRAINT RefDIVISION1618 
    FOREIGN KEY (APP_SID, DIVISION_ID)
    REFERENCES DIVISION(APP_SID, DIVISION_ID)
;


@update_tail
