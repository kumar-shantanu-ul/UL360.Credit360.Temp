-- Please update version.sql too -- this keeps clean builds in sync
define version=887
@update_header

ALTER TABLE CSR.FEED DROP CONSTRAINT CHK_FEED_TYPE;

ALTER TABLE CSR.FEED ADD CONSTRAINT CHK_FEED_TYPE CHECK (
  (URL IS NULL AND PROTOCOL IS NULL AND INTERVAL IS NULL AND USERNAME IS NULL AND HOST_KEY IS NULL AND FEED_TYPE_ID=1)
  OR
  (URL IS NOT NULL AND PROTOCOL IS NOT NULL AND INTERVAL IS NOT NULL AND USERNAME IS NOT NULL AND HOST_KEY IS NOT NULL AND FEED_TYPE_ID<>1)
);

@update_tail