-- Please update version.sql too -- this keeps clean builds in sync
define version=1259
@update_header

CREATE TABLE CT.WORKSHEET_VALUE_MAP_DISTANCE (
    APP_SID NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'APP') NOT NULL,
    VALUE_MAP_ID NUMBER(10) NOT NULL,
    VALUE_MAPPER_ID NUMBER(10) DEFAULT 110 NOT NULL,
    DISTANCE_UNIT_ID NUMBER(10),
    CONSTRAINT PK_WSVM_DISTANCE PRIMARY KEY (APP_SID, VALUE_MAP_ID, VALUE_MAPPER_ID)
);

ALTER TABLE CT.WORKSHEET_VALUE_MAP_DISTANCE ADD CONSTRAINT CC_WSVM_DISTANCE_VHID 
    CHECK (VALUE_MAPPER_ID = 110);

ALTER TABLE CT.WORKSHEET_VALUE_MAP_DISTANCE ADD CONSTRAINT WS_VALUE_MAP_WSVM_DISTANCE 
    FOREIGN KEY (APP_SID, VALUE_MAP_ID, VALUE_MAPPER_ID) REFERENCES CSR.WORKSHEET_VALUE_MAP (APP_SID,VALUE_MAP_ID,VALUE_MAPPER_ID);

ALTER TABLE CT.WORKSHEET_VALUE_MAP_DISTANCE ADD CONSTRAINT DIST_UNIT_WSVM_DISTANCE 
    FOREIGN KEY (DISTANCE_UNIT_ID) REFERENCES CT.DISTANCE_UNIT (DISTANCE_UNIT_ID);
  
BEGIN
	INSERT INTO CSR.WORKSHEET_TYPE (WORKSHEET_TYPE_ID, DESCRIPTION) VALUES (101, 'Business Travel');
		
	INSERT INTO CSR.WORKSHEET_VALUE_MAPPER (VALUE_MAPPER_ID, CLASS_TYPE, MAPPER_NAME, MAPPER_DESCRIPTION, JS_COMPONENT_PATH, JS_COMPONENT) VALUES (110, 'Credit360.CarbonTrust.Excel.DistanceMapper', 'Distance unit', 'Map the distance unit of measure found in the worksheet to types that the system uses', '/csr/site/ct/components/excel/DistanceUnitCombo.js', 'CarbonTrust.excel.DistanceUnitCombo');

	INSERT INTO CSR.WORKSHEET_COLUMN_TYPE (COLUMN_TYPE_ID, WORKSHEET_TYPE_ID, POSITION, VALUE_MAPPER_ID, NAME, DESCRIPTION, REQUIRED) VALUES (1100, 101,  1, NULL, 'Description', 'The description of the journey', 1);
	INSERT INTO CSR.WORKSHEET_COLUMN_TYPE (COLUMN_TYPE_ID, WORKSHEET_TYPE_ID, POSITION, VALUE_MAPPER_ID, NAME, DESCRIPTION) VALUES (1101, 101,  2, NULL, 'Travel date', 'The date that the journey took place');
	INSERT INTO CSR.WORKSHEET_COLUMN_TYPE (COLUMN_TYPE_ID, WORKSHEET_TYPE_ID, POSITION, VALUE_MAPPER_ID, NAME, DESCRIPTION) VALUES (1102, 101,  3, NULL, 'Transaction date', 'The date that the expense was recorded');
	INSERT INTO CSR.WORKSHEET_COLUMN_TYPE (COLUMN_TYPE_ID, WORKSHEET_TYPE_ID, POSITION, VALUE_MAPPER_ID, NAME, DESCRIPTION) VALUES (1103, 101,  4, NULL, 'Distance travelled', 'The distance that was travelled during the journey');
	INSERT INTO CSR.WORKSHEET_COLUMN_TYPE (COLUMN_TYPE_ID, WORKSHEET_TYPE_ID, POSITION, VALUE_MAPPER_ID, NAME, DESCRIPTION) VALUES (1104, 101,  5, 110, 'Distance unit', 'The unit of measure for the distance that was travelled during the journey');
	INSERT INTO CSR.WORKSHEET_COLUMN_TYPE (COLUMN_TYPE_ID, WORKSHEET_TYPE_ID, POSITION, VALUE_MAPPER_ID, NAME, DESCRIPTION) VALUES (1105, 101,  6, NULL, 'Time travelled', 'The time taken in minutes complete the journey. For trips by train or air, this should be the scheduled time.');
	INSERT INTO CSR.WORKSHEET_COLUMN_TYPE (COLUMN_TYPE_ID, WORKSHEET_TYPE_ID, POSITION, VALUE_MAPPER_ID, NAME, DESCRIPTION) VALUES (1106, 101,  7, NULL, 'Spend', 'The amount spent on the journey');
	INSERT INTO CSR.WORKSHEET_COLUMN_TYPE (COLUMN_TYPE_ID, WORKSHEET_TYPE_ID, POSITION, VALUE_MAPPER_ID, NAME, DESCRIPTION) VALUES (1107, 101,  8, 100, 'Currency', 'The currency of spend for the journey');
END;
/

@..\ct\excel_pkg
@..\ct\excel_body
@..\ct\util_pkg
@..\ct\util_body

@update_tail
