-- Please update version.sql too -- this keeps clean builds in sync
define version=1221
@update_header



CREATE TABLE CT.PS_LEVEL_CONTRIBUTIONS (
    APP_SID NUMBER(10) DEFAULT SYS_CONTEXT('SECURITY', 'APP') NOT NULL,
    CALCULATION_SOURCE_ID NUMBER(10) NOT NULL,
    CONTRIBUTION_SOURCE_ID NUMBER(10) NOT NULL,
    PCT NUMBER(20,10) NOT NULL,
    CONSTRAINT PK_PSLC PRIMARY KEY (APP_SID, CALCULATION_SOURCE_ID, CONTRIBUTION_SOURCE_ID)
);

ALTER TABLE CT.PS_LEVEL_CONTRIBUTIONS ADD CONSTRAINT CC_PSLC_PCT 
    CHECK (PCT >= 0);
	
	

ALTER TABLE CT.PS_LEVEL_CONTRIBUTIONS ADD CONSTRAINT CONT_SOURCE_PSLC 
    FOREIGN KEY (CONTRIBUTION_SOURCE_ID) REFERENCES CT.CALCULATION_SOURCE (CALCULATION_SOURCE_ID);

ALTER TABLE CT.PS_LEVEL_CONTRIBUTIONS ADD CONSTRAINT CALCULATION_SOURCE_PSLC 
    FOREIGN KEY (CALCULATION_SOURCE_ID) REFERENCES CT.CALCULATION_SOURCE (CALCULATION_SOURCE_ID);

ALTER TABLE CT.PS_LEVEL_CONTRIBUTIONS ADD CONSTRAINT CUSTOMER_OPTIONS_PSLC 
    FOREIGN KEY (APP_SID) REFERENCES CT.CUSTOMER_OPTIONS (APP_SID);

@..\ct\products_services_pkg
@..\ct\products_services_body
@..\ct\rls

	
@update_tail