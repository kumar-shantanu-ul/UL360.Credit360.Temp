-- Please update version too -- this keeps clean builds in sync
define version=1848
@update_header


CREATE TABLE CSRIMP.EXPORT_FEED (
	CSRIMP_SESSION_ID			NUMBER(10)		DEFAULT SYS_CONTEXT('SECURITY', 'CSRIMP_SESSION_ID') NOT NULL,
	EXPORT_FEED_SID 			NUMBER(10)		NOT NULL,
	NAME			 			VARCHAR2(100)	NOT NULL,
	PROTOCOL					NUMBER(1)		NOT NULL,
	URL							VARCHAR2(1024) 	NOT NULL,
	USERNAME					VARCHAR2(40) 	NOT NULL,
	INTERVAL					VARCHAR2(2)		NOT NULL,
	START_DTM					DATE			NOT NULL,
	END_DTM						DATE,
	LAST_SUCCESS_ATTEMPT_DTM	DATE,
	LAST_ATTEMPT_DTM			DATE,
	SECURE_CREDS				CLOB NULL,
	CONSTRAINT PK_EXPORT_FEED PRIMARY KEY (EXPORT_FEED_SID),
	CONSTRAINT FK_EXPORT_FEED_IS FOREIGN KEY
		(CSRIMP_SESSION_ID) REFERENCES CSRIMP.CSRIMP_SESSION (CSRIMP_SESSION_ID)
		ON DELETE CASCADE
);


CREATE TABLE CSRIMP.EXPORT_FEED_CMS_FORM (
	CSRIMP_SESSION_ID	NUMBER(10)			DEFAULT SYS_CONTEXT('SECURITY', 'CSRIMP_SESSION_ID') NOT NULL,
	EXPORT_FEED_SID		NUMBER(10)			NOT NULL,
	FORM_SID			NUMBER(10)			NOT NULL,
	FILENAME_MASK		VARCHAR2(255)		NOT NULL,
	FORMAT				NUMBER(1)			NOT NULL,
	INCREMENTAL			NUMBER(1)			NOT NULL,		
	CONSTRAINT PK_EXPORT_FEED_CMS_FORM PRIMARY KEY (EXPORT_FEED_SID, FORM_SID),
	CONSTRAINT FK_EF_CMS_FORM_IS FOREIGN KEY
		(CSRIMP_SESSION_ID) REFERENCES CSRIMP.CSRIMP_SESSION (CSRIMP_SESSION_ID)
		ON DELETE CASCADE
);

CREATE TABLE CSRIMP.EXPORT_FEED_DATAVIEW (
	CSRIMP_SESSION_ID	NUMBER(10)			DEFAULT SYS_CONTEXT('SECURITY', 'CSRIMP_SESSION_ID') NOT NULL,
	EXPORT_FEED_SID		NUMBER(10)			NOT NULL,
	DATAVIEW_SID		NUMBER(10)			NOT NULL,
	FILENAME_MASK		VARCHAR2(255)		NOT NULL,
	FORMAT				NUMBER(1)			NOT NULL,
	ASSEMBLY_NAME		VARCHAR2(150)		NOT NULL,
	CONSTRAINT PK_EXPORT_FEED_DATAVIEW PRIMARY KEY (EXPORT_FEED_SID, DATAVIEW_SID),
	CONSTRAINT FK_EF_DATAVIEW_IS FOREIGN KEY
		(CSRIMP_SESSION_ID) REFERENCES CSRIMP.CSRIMP_SESSION (CSRIMP_SESSION_ID)
		ON DELETE CASCADE
);

CREATE TABLE CSRIMP.EXPORT_FEED_STORED_PROC (
	CSRIMP_SESSION_ID	NUMBER(10)			DEFAULT SYS_CONTEXT('SECURITY', 'CSRIMP_SESSION_ID') NOT NULL,
	EXPORT_FEED_SID		NUMBER(10)			NOT NULL,
	SP_NAME		    	VARCHAR2(100)		NOT NULL,
	SP_PARAMS			VARCHAR2(255)		NOT NULL,
	FILENAME_MASK		VARCHAR2(255)		NOT NULL,
	FORMAT				NUMBER(1)			NOT NULL,
	CONSTRAINT FK_EF_STORED_PROC_IS FOREIGN KEY
		(CSRIMP_SESSION_ID) REFERENCES CSRIMP.CSRIMP_SESSION (CSRIMP_SESSION_ID)
		ON DELETE CASCADE
);

@..\schema_pkg
@..\schema_body

@update_tail
