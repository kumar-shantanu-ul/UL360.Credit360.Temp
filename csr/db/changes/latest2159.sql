-- Please update version.sql too -- this keeps clean builds in sync
define version=2159
@update_header


ALTER TABLE CSR.INITIATIVE_METRIC_STATE_IND DROP CONSTRAINT PK_INITIATIVE_METRIC_IND;

ALTER TABLE CSR.INITIATIVE_METRIC_STATE_IND ADD(
	CONSTRAINT PK_INITIATIVE_METRIC_IND PRIMARY KEY (APP_SID, INITIATIVE_METRIC_ID, FLOW_STATE_GROUP_ID, IND_SID)
);

ALTER TABLE CSR.INITIATIVE_METRIC_TAG_IND DROP CONSTRAINT PK_INITIATIVE_METRIC_TAG_IND;

ALTER TABLE CSR.INITIATIVE_METRIC_TAG_IND ADD(
	CONSTRAINT PK_INITIATIVE_METRIC_TAG_IND PRIMARY KEY (APP_SID, INITIATIVE_METRIC_ID, AGGR_TAG_GROUP_ID, IND_SID)
);

ALTER TABLE CSR.INITIATIVE_METRIC_STATE_IND ADD CONSTRAINT FK_IND_INITMETIND_PRI
    FOREIGN KEY (APP_SID, IND_SID)
    REFERENCES CSR.IND(APP_SID, IND_SID)
;

ALTER TABLE CSR.INITIATIVE_METRIC_TAG_IND ADD CONSTRAINT FK_IND_INITMETTAGIND_PRI 
    FOREIGN KEY (APP_SID, IND_SID)
    REFERENCES CSR.IND(APP_SID, IND_SID)
;

-- This index was already applied in latest1879
--CREATE INDEX CSR.IX_IND_INITMETIND_PRI ON CSR.INITIATIVE_METRIC_STATE_IND(APP_SID, IND_SID);
CREATE INDEX CSR.IX_IND_INITMETTAGIND_PRI ON CSR.INITIATIVE_METRIC_TAG_IND(APP_SID, IND_SID);

@../initiative_aggr_body

@update_tail
