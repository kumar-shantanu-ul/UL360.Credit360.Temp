-- Please update version.sql too -- this keeps clean builds in sync
define version=918
@update_header

CREATE SEQUENCE CSR.USER_COVER_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 20
    NOORDER
;


CREATE TABLE CSR.USER_COVER(
    APP_SID                   NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    USER_COVER_ID             NUMBER(10, 0)    NOT NULL,
    USER_GIVING_COVER_SID     NUMBER(10, 0)    NOT NULL,
    USER_BEING_COVERED_SID    NUMBER(10, 0)    NOT NULL,
    START_DTM                 DATE             NOT NULL,
    END_DTM                   DATE,
    COVER_TERMINATED          NUMBER(1, 0)     DEFAULT 0 NOT NULL,
    CONSTRAINT PK1254 PRIMARY KEY (APP_SID, USER_COVER_ID, USER_GIVING_COVER_SID, USER_BEING_COVERED_SID)
)
;

ALTER TABLE CSR.USER_COVER ADD CONSTRAINT FK_CSR_USER_USER_COVER_B 
    FOREIGN KEY (APP_SID, USER_BEING_COVERED_SID)
    REFERENCES CSR.CSR_USER(APP_SID, CSR_USER_SID)
;

ALTER TABLE CSR.USER_COVER ADD CONSTRAINT FK_CSR_USER_USER_COVER_G 
    FOREIGN KEY (APP_SID, USER_GIVING_COVER_SID)
    REFERENCES CSR.CSR_USER(APP_SID, CSR_USER_SID)
;

ALTER TABLE CSR.USER_COVER ADD CONSTRAINT FK_CUSTOMER_USER_COVER 
    FOREIGN KEY (APP_SID)
    REFERENCES CSR.CUSTOMER(APP_SID)
;


	
CREATE TABLE CSR.DELEGATION_USER_COVER(
    APP_SID                   NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    USER_COVER_ID             NUMBER(10, 0)    NOT NULL,
    USER_GIVING_COVER_SID     NUMBER(10, 0)    NOT NULL,
    USER_BEING_COVERED_SID    NUMBER(10, 0)    NOT NULL,
    DELEGATION_SID            NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK1259 PRIMARY KEY (APP_SID, USER_COVER_ID, USER_GIVING_COVER_SID, DELEGATION_SID, USER_BEING_COVERED_SID)
)
;
ALTER TABLE CSR.DELEGATION_USER_COVER ADD CONSTRAINT FK_DELEG_USER_COVER_UC 
    FOREIGN KEY (APP_SID, USER_COVER_ID, USER_GIVING_COVER_SID, USER_BEING_COVERED_SID)
    REFERENCES CSR.USER_COVER(APP_SID, USER_COVER_ID, USER_GIVING_COVER_SID, USER_BEING_COVERED_SID)
;

ALTER TABLE CSR.DELEGATION_USER_COVER ADD CONSTRAINT FK_DELEG_USER_DUC 
    FOREIGN KEY (APP_SID, DELEGATION_SID, USER_BEING_COVERED_SID)
    REFERENCES CSR.DELEGATION_USER(APP_SID, DELEGATION_SID, USER_SID)
;
	
@..\user_cover_pkg
@..\user_cover_body
@..\delegation_pkg
@..\delegation_pkg
@..\csr_user_pkg
@..\csr_user_body

@update_tail
