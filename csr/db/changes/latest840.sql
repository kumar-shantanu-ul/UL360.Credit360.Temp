-- Please update version.sql too -- this keeps clean builds in sync
define version=840
@update_header


-- for site deletion (changed in db2\object_grants)
GRANT DELETE ON ACTIONS.IND_TEMPLATE_GROUP TO CSR;
GRANT DELETE ON ACTIONS.PERIODIC_REPORT_TEMPLATE TO CSR;

ALTER TABLE CSR.FLOW_STATE_TRANSITION ADD (LOOKUP_KEY VARCHAR2(255));

CREATE UNIQUE INDEX CSR.UK_FLOW_ST_TR_LOOKUP ON CSR.FLOW_STATE_TRANSITION(APP_SID, FROM_STATE_ID, NVL(UPPER(LOOKUP_KEY),'FLST'||TO_CHAR(FLOW_STATE_TRANSITION_ID)));

DROP TYPE CSR.T_FLOW_STATE_TRANS_TABLE;

CREATE OR REPLACE TYPE CSR.T_FLOW_STATE_TRANS_ROW AS
	OBJECT (
		POS					NUMBER(10),
		ID					NUMBER(10),	
		FROM_STATE_ID		NUMBER(10),
		TO_STATE_ID			NUMBER(10),
		ASK_FOR_COMMENT		VARCHAR2(16),
		VERB				VARCHAR2(255),
		LOOKUP_KEY			VARCHAR2(255),
		ROLE_SIDS			VARCHAR2(2000),
		ATTRIBUTES_XML		XMLType
	);
/

CREATE OR REPLACE TYPE CSR.T_FLOW_STATE_TRANS_TABLE AS
  TABLE OF CSR.T_FLOW_STATE_TRANS_ROW;
/



@..\chain\chain_pkg
@..\csr_data_pkg
@..\flow_pkg

@..\chain\chain_body
@..\csr_data_body
@..\flow_body


@update_tail
