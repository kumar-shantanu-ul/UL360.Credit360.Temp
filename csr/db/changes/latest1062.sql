-- Please update version.sql too -- this keeps clean builds in sync
define version=1062
@update_header

 
CREATE TABLE CSR.FLOW_STATE_TRANS_HELPER(
    APP_SID      NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    FLOW_SID     NUMBER(10, 0)    NOT NULL,
    HELPER_SP    VARCHAR2(255)    NOT NULL,
    LABEL        VARCHAR2(255)    NOT NULL,
    CONSTRAINT PK_FLOW_STATE_TRANS_HELPER PRIMARY KEY (APP_SID, FLOW_SID, HELPER_SP)
);

ALTER TABLE CSR.FLOW_STATE_TRANS_HELPER ADD CONSTRAINT FK_FLOW_FLSTTRHELPER 
    FOREIGN KEY (APP_SID, FLOW_SID)
    REFERENCES CSR.FLOW(APP_SID, FLOW_SID);


INSERT INTO CSR.FLOW_STATE_TRANS_HELPER (app_sid, flow_sid, helper_sp, label)
	SELECT distinct app_sid, flow_sid, helper_sp, helper_sp
	  FROM CSR.FLOW_STATE_TRANSITION
	 WHERE HELPER_SP IS NOT NULL;

ALTER TABLE CSR.FLOW_STATE_TRANSITION ADD CONSTRAINT FK_FLSTTRHELPER_FLSTTR 
    FOREIGN KEY (APP_SID, FLOW_SID, HELPER_SP)
    REFERENCES CSR.FLOW_STATE_TRANS_HELPER(APP_SID, FLOW_SID, HELPER_SP);


@update_tail
