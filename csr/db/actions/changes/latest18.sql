-- Please update version.sql too -- this keeps clean builds in sync
define version=18
@update_header

DROP TABLE AGGREGATE_TASKS;

CREATE GLOBAL TEMPORARY TABLE AGGREGATE_TASKS
(
	LVL					NUMBER(10, 0)	NOT NULL,
	TASK_SID			NUMBER(10, 0)	NOT NULL,
	TASK_START_DTM		DATE			NOT NULL,	
	TASK_END_DTM		DATE			NOT NULL,
	TASK_INTERVAL		NUMBER(10, 0)	NOT NULL,
	REGION_SID			NUMBER(10, 0)	NOT NULL,
	IND_SID				NUMBER(10, 0)	NOT NULL,
	PERIOD_START_DTM	DATE			NOT NULL,
	PERIOD_END_DTM		DATE			NOT NULL,
	PARENT_REGION_SID	NUMBER(10, 0) 	NULL
)
ON COMMIT DELETE ROWS;


CREATE TABLE AGGR_TASK_IND_DEPENDENCY(
    TASK_SID    NUMBER(10, 0)    NOT NULL,
    IND_SID     NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK54 PRIMARY KEY (TASK_SID)
);

CREATE TABLE AGGR_TASK_TASK_DEPENDENCY(
    TASK_SID               NUMBER(10, 0)    NOT NULL,
    DEPENDS_ON_TASK_SID    NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK53 PRIMARY KEY (TASK_SID, DEPENDS_ON_TASK_SID)
);

ALTER TABLE AGGR_TASK_IND_DEPENDENCY ADD CONSTRAINT RefTASK70 
    FOREIGN KEY (TASK_SID)
    REFERENCES TASK(TASK_SID)
;

ALTER TABLE AGGR_TASK_TASK_DEPENDENCY ADD CONSTRAINT RefTASK71 
    FOREIGN KEY (DEPENDS_ON_TASK_SID)
    REFERENCES TASK(TASK_SID)
;

ALTER TABLE AGGR_TASK_TASK_DEPENDENCY ADD CONSTRAINT RefTASK72 
    FOREIGN KEY (TASK_SID)
    REFERENCES TASK(TASK_SID)
;


@update_tail