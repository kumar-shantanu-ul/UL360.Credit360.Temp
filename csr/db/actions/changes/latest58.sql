-- Please update version.sql too -- this keeps clean builds in sync
define version=58
@update_header

CREATE SEQUENCE RECKONER_CONST_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 20
    NOORDER
;

CREATE SEQUENCE RECKONER_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 20
    NOORDER
;

CREATE SEQUENCE RECKONER_INPUT_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 20
    NOORDER
;

CREATE SEQUENCE RECKONER_OUTPUT_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 20
    NOORDER
;

CREATE TABLE RECKONER(
    RECKONER_ID    NUMBER(10, 0)     NOT NULL,
    LABEL          VARCHAR2(256)     NOT NULL,
    DESCRIPTION    VARCHAR2(4000),
    SCRIPT         CLOB,
    CONSTRAINT PK106 PRIMARY KEY (RECKONER_ID)
)
;

CREATE TABLE RECKONER_CONST(
    RECKONER_CONST_ID    NUMBER(10, 0)     NOT NULL,
    NAME                 VARCHAR2(256)     NOT NULL,
    LABEL                VARCHAR2(256)    NOT NULL,
    VAL                  NUMBER(24, 10)    NOT NULL,
    CONSTRAINT PK108 PRIMARY KEY (RECKONER_CONST_ID)
)
;

CREATE TABLE RECKONER_CONST_DEP(
    RECKONER_ID          NUMBER(10, 0)    NOT NULL,
    RECKONER_CONST_ID    NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK111 PRIMARY KEY (RECKONER_ID, RECKONER_CONST_ID)
)
;

CREATE TABLE RECKONER_INPUT(
    RECKONER_ID          NUMBER(10, 0)    NOT NULL,
    RECKONER_INPUT_ID    NUMBER(10, 0)    NOT NULL,
    NAME                 VARCHAR2(256)    NOT NULL,
    LABEL                VARCHAR2(256)    NOT NULL,
    POS                  NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK107 PRIMARY KEY (RECKONER_ID, RECKONER_INPUT_ID)
)
;

CREATE TABLE RECKONER_OUTPUT(
    RECKONER_ID           NUMBER(10, 0)    NOT NULL,
    RECKONER_OUTPUT_ID    NUMBER(10, 0)    NOT NULL,
    NAME                  VARCHAR2(256)	   NOT NULL,
    LABEL                 VARCHAR2(256)	   NOT NULL,
    MAP_TO                VARCHAR2(256),
    CONSTRAINT PK109 PRIMARY KEY (RECKONER_ID, RECKONER_OUTPUT_ID)
)
;

CREATE TABLE RECKONER_SCOPE(
    APP_SID         NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    PROJECT_SID     NUMBER(10, 0)    NOT NULL,
    TAG_GROUP_ID    NUMBER(10, 0)    NOT NULL,
    TAG_ID          NUMBER(10, 0)    NOT NULL,
    RECKONER_ID     NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK110 PRIMARY KEY (APP_SID, PROJECT_SID, TAG_GROUP_ID, TAG_ID, RECKONER_ID)
)
;


ALTER TABLE RECKONER_CONST_DEP ADD CONSTRAINT RefRECKONER_CONST201 
    FOREIGN KEY (RECKONER_CONST_ID)
    REFERENCES RECKONER_CONST(RECKONER_CONST_ID)
;

ALTER TABLE RECKONER_CONST_DEP ADD CONSTRAINT RefRECKONER202 
    FOREIGN KEY (RECKONER_ID)
    REFERENCES RECKONER(RECKONER_ID)
;

ALTER TABLE RECKONER_INPUT ADD CONSTRAINT RefRECKONER203 
    FOREIGN KEY (RECKONER_ID)
    REFERENCES RECKONER(RECKONER_ID)
;


ALTER TABLE RECKONER_OUTPUT ADD CONSTRAINT RefRECKONER204 
    FOREIGN KEY (RECKONER_ID)
    REFERENCES RECKONER(RECKONER_ID)
;


ALTER TABLE RECKONER_SCOPE ADD CONSTRAINT RefRECKONER205 
    FOREIGN KEY (RECKONER_ID)
    REFERENCES RECKONER(RECKONER_ID)
;

ALTER TABLE RECKONER_SCOPE ADD CONSTRAINT RefPROJECT_TAG_GROUP212 
    FOREIGN KEY (APP_SID, TAG_GROUP_ID, PROJECT_SID)
    REFERENCES PROJECT_TAG_GROUP(APP_SID, TAG_GROUP_ID, PROJECT_SID)
;

ALTER TABLE RECKONER_SCOPE ADD CONSTRAINT RefTAG_GROUP_MEMBER213 
    FOREIGN KEY (APP_SID, TAG_GROUP_ID, TAG_ID)
    REFERENCES TAG_GROUP_MEMBER(APP_SID, TAG_GROUP_ID, TAG_ID)
;


@update_tail
