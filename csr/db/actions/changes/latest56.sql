-- Please update version.sql too -- this keeps clean builds in sync
define version=56
@update_header

CREATE SEQUENCE FILE_UPLOAD_GROUP_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    CACHE 20
    NOORDER
;

CREATE TABLE FILE_UPLOAD_GROUP(
    FILE_UPLOAD_GROUP_ID    NUMBER(10, 0)     NOT NULL,
    APP_SID                 NUMBER(10, 0)     DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    NAME                    VARCHAR2(256)     NOT NULL,
    LABEL                   VARCHAR2(1024)    NOT NULL,
    CONSTRAINT PK97 PRIMARY KEY (FILE_UPLOAD_GROUP_ID)
)
;

CREATE TABLE FILE_UPLOAD_GROUP_MEMBER(
    FILE_UPLOAD_GROUP_ID    NUMBER(10, 0)    NOT NULL,
    APP_SID                 NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    FILE_ID                 NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK98 PRIMARY KEY (FILE_UPLOAD_GROUP_ID, APP_SID, FILE_ID)
)
;

CREATE TABLE PROJECT_FILE_UPLOAD_GROUP(
    FILE_UPLOAD_GROUP_ID    NUMBER(10, 0)    NOT NULL,
    APP_SID                 NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    PROJECT_SID             NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK99 PRIMARY KEY (FILE_UPLOAD_GROUP_ID, APP_SID, PROJECT_SID)
)
;

ALTER TABLE FILE_UPLOAD_GROUP ADD CONSTRAINT RefCUSTOMER190 
    FOREIGN KEY (APP_SID)
    REFERENCES CSR.CUSTOMER(APP_SID)
;

ALTER TABLE FILE_UPLOAD_GROUP_MEMBER ADD CONSTRAINT RefFILE_UPLOAD185 
    FOREIGN KEY (APP_SID, FILE_ID)
    REFERENCES FILE_UPLOAD(APP_SID, FILE_ID)
;

ALTER TABLE FILE_UPLOAD_GROUP_MEMBER ADD CONSTRAINT RefFILE_UPLOAD_GROUP186 
    FOREIGN KEY (FILE_UPLOAD_GROUP_ID)
    REFERENCES FILE_UPLOAD_GROUP(FILE_UPLOAD_GROUP_ID)
;

ALTER TABLE PROJECT_FILE_UPLOAD_GROUP ADD CONSTRAINT RefPROJECT187 
    FOREIGN KEY (APP_SID, PROJECT_SID)
    REFERENCES PROJECT(APP_SID, PROJECT_SID)
;

ALTER TABLE PROJECT_FILE_UPLOAD_GROUP ADD CONSTRAINT RefFILE_UPLOAD_GROUP188 
    FOREIGN KEY (FILE_UPLOAD_GROUP_ID)
    REFERENCES FILE_UPLOAD_GROUP(FILE_UPLOAD_GROUP_ID)
;

CREATE TABLE INITIATIVE_SPONSOR(
    APP_SID     NUMBER(10, 0)    DEFAULT SYS_CONTEXT('SECURITY','APP') NOT NULL,
    TASK_SID    NUMBER(10, 0)    NOT NULL,
    NAME        VARCHAR2(512)    NOT NULL,
    EMAIL       VARCHAR2(512)
)
;

ALTER TABLE INITIATIVE_SPONSOR ADD CONSTRAINT RefTASK193 
    FOREIGN KEY (APP_SID, TASK_SID)
    REFERENCES TASK(APP_SID, TASK_SID)
;

ALTER TABLE PROJECT ADD (
	ABBREVIATION              VARCHAR2(16)	NULL
);

ALTER TABLE CUSTOMER_OPTIONS ADD (
	INITIATIVE_NAME_GEN_PROC    VARCHAR2(256) NULL
);

-- Update rls
@../rls

@update_tail
