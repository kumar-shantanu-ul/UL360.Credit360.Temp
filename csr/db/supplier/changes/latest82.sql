-- Please update version.sql too -- this keeps clean builds in sync
define version=82
@update_header

-- TABLE: TAG_ATTRIBUTE 
--

CREATE TABLE supplier.TAG_ATTRIBUTE(
    TAG_ATTRIBUTE_ID    NUMBER(10, 0)    NOT NULL,
    NAME                VARCHAR2(32)     NOT NULL,    --TODO : ADD UNIQUE constraint
    DESCRIPTION         VARCHAR2(256),
    CONSTRAINT PK_TAG_ATTRIBUTE PRIMARY KEY (TAG_ATTRIBUTE_ID)
)
;

-- TABLE: TAG_TAG_ATTRIBUTE 
--

CREATE TABLE supplier.TAG_TAG_ATTRIBUTE(
    TAG_ID              NUMBER(10, 0)    NOT NULL,
    TAG_ATTRIBUTE_ID    NUMBER(10, 0)    NOT NULL,
    CONSTRAINT PK_TAG_TAG_ATTRIBUTE PRIMARY KEY (TAG_ID, TAG_ATTRIBUTE_ID)
)
;

-- TABLE: TAG_TAG_ATTRIBUTE 
--

ALTER TABLE supplier.TAG_TAG_ATTRIBUTE ADD CONSTRAINT RefTAG_ATTRIBUTE727 
    FOREIGN KEY (TAG_ATTRIBUTE_ID)
    REFERENCES supplier.TAG_ATTRIBUTE(TAG_ATTRIBUTE_ID)
;

ALTER TABLE supplier.TAG_TAG_ATTRIBUTE ADD CONSTRAINT RefTAG728 
    FOREIGN KEY (TAG_ID)
    REFERENCES supplier.TAG(TAG_ID)
;

-- alter questionnaire_tag table to support unmapping function between the rules (tags) 
-- and questionnaires e.g. no packaging tag should not map to packaging questionnaire
ALTER TABLE supplier.QUESTIONNAIRE_TAG ADD (mapped NUMBER(1,0) DEFAULT 1 NOT NULL);


-- 
-- TABLE: PRODUCT_REVISION_TAG 
--

CREATE TABLE supplier.PRODUCT_REVISION_TAG(
    PRODUCT_ID     NUMBER(10, 0)     NOT NULL,
    REVISION_ID    NUMBER(10, 0)     NOT NULL,
    TAG_ID         NUMBER(10, 0)     NOT NULL,
    GROUP_ID       NUMBER(10, 0)     NOT NULL,
    NOTE           VARCHAR2(1024),
    NUM            NUMBER(24, 10),
    CONSTRAINT PK_PRODUCT_REVISION_TAG PRIMARY KEY (PRODUCT_ID, REVISION_ID, TAG_ID, GROUP_ID)
)
;

-- 
-- TABLE: PRODUCT_REVISION_TAG 
--

ALTER TABLE supplier.PRODUCT_REVISION_TAG ADD CONSTRAINT RefTAG735 
    FOREIGN KEY (TAG_ID)
    REFERENCES supplier.TAG(TAG_ID)
;

ALTER TABLE supplier.PRODUCT_REVISION_TAG ADD CONSTRAINT RefPRODUCT_REVISION736 
    FOREIGN KEY (PRODUCT_ID, REVISION_ID)
    REFERENCES supplier.PRODUCT_REVISION(PRODUCT_ID, REVISION_ID)
;

ALTER TABLE supplier.PRODUCT_REVISION_TAG ADD CONSTRAINT RefQUESTIONNAIRE_GROUP738 
    FOREIGN KEY (GROUP_ID)
    REFERENCES supplier.QUESTIONNAIRE_GROUP(GROUP_ID)
;

@update_tail
